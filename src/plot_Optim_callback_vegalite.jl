using VegaLite, DataFrames #
using LaTeXStrings




df = DataFrame(
    method = Array{String}(undef, 0),
    time = Array{Float64}(undef, 0),
    iteration = Array{Int64}(undef, 0),
    qval = Array{Float64}(undef, 0),
    normgradq = Array{Float64}(undef, 0)
)
function mypush!(df, method_name, time_iter_q_normgradq)
    start_time = time_iter_q_normgradq[1, 1]
    for i in 1:size(time_iter_q_normgradq, 1)
        time_iter_q_normgradq[i, 1] -= start_time
        push!(df, [method_name; time_iter_q_normgradq[i, :]])
    end
    return df
end

println("The data being plotted was copy-pasted from Katana output!")
#    time                   iteration      q(λ)           |Dq(λ)|
method_name = "FLASH"
time_iter_q_normgradq = [
    1.552363418279547e9     -1     9.973847e-02     9.846679e-02
    1552363521.0545940399     0     9.973847e-02     9.846679e-02
    1552363622.6556909084     1     1.679872e-02     6.089963e-02
    1552363751.5853049755     2     6.970948e-03     2.493615e-02
    1552363808.936674118     3     5.678646e-03     2.274644e-03
    1552363856.407294035     4     5.529870e-03     9.008393e-04
    1552363912.0315229893     5     5.521264e-03     4.901419e-05
    1552363953.6387810707     6     5.521236e-03     5.834928e-07
    1552363980.9831380844     7     5.521236e-03     3.744009e-10
]
mypush!(df, method_name, time_iter_q_normgradq)


method_name = "FiniteDiff"
time_iter_q_normgradq = [
    1.552363994641155e9     -1     9.973847e-02     9.846679e-02
    1552364358.3094890118     0     9.973847e-02     9.846679e-02
    1552364717.8997280598     1     1.679853e-02     6.089921e-02
    1552365123.1920530796     2     6.970752e-03     2.493435e-02
    1552365446.5719571114     3     5.678668e-03     2.275158e-03
    1552365754.4294710159     4     5.529873e-03     9.009779e-04
    1552366075.0072140694     5     5.521264e-03     4.902208e-05
    1552366385.0856909752     6     5.521236e-03     5.855503e-07
    1552366412.7349050045     7     5.521236e-03     3.754357e-10
]
mypush!(df, method_name, time_iter_q_normgradq)

method_name = "Dual"
time_iter_q_normgradq = [
    1.552366421255873e9     -1     9.973847e-02     9.846679e-02
    1552366717.5611829758     0     9.973847e-02     9.846679e-02
    1552366971.8519530296     1     1.679872e-02     6.089963e-02
    1552367304.4924180508     2     6.970948e-03     2.493615e-02
    1552367513.8661060333     3     5.678646e-03     2.274644e-03
    1552367711.213999033     4     5.529870e-03     9.008393e-04
    1552367967.0133960247     5     5.521264e-03     4.901418e-05
    1552368162.9782109261     6     5.521236e-03     5.834950e-07
    1552368190.1998560429     7     5.521236e-03     3.895088e-10
]
mypush!(df, method_name, time_iter_q_normgradq)

method_name = "Complex"
time_iter_q_normgradq = [
    1.552368198701733e9     -1     9.973847e-02     9.846679e-02
    1552368664.8961520195     0     9.973847e-02     9.846679e-02
    1552369043.9944880009     1     1.679872e-02     6.089963e-02
    1552369555.6746160984     2     6.970948e-03     2.493615e-02
    1552369882.934237957     3     5.678646e-03     2.274644e-03
    1552370207.917828083     4     5.529870e-03     9.008393e-04
    1552370646.1565849781     5     5.521264e-03     4.901418e-05
    1552370977.9620931149     6     5.521236e-03     5.834949e-07
    1552371005.8760120869     7     5.521236e-03     3.976156e-10
]
mypush!(df, method_name, time_iter_q_normgradq)

method_name = "HyperDual"
time_iter_q_normgradq = [
    1.55237101458678e9     -1     9.973847e-02     9.846679e-02
    1552371580.6637198925     0     9.973847e-02     9.846679e-02
    1552372099.805480957     1     1.679872e-02     6.089963e-02
    1552372703.6253418922     2     6.970948e-03     2.493615e-02
    1552373179.1694459915     3     5.678646e-03     2.274644e-03
    1552373645.9091169834     4     5.529870e-03     9.008393e-04
    1552374174.8496110439     5     5.521264e-03     4.901418e-05
    1552374639.23792696     6     5.521236e-03     5.834937e-07
    1552374762.3275139332     7     5.521236e-03     3.820827e-10
]
mypush!(df, method_name, time_iter_q_normgradq)


method_name = "sym-HyperDual"
time_iter_q_normgradq = [
    1.55237477090236e9     -1     9.973847e-02     9.846679e-02
    1552375189.6387989521     0     9.973847e-02     9.846679e-02
    1552375569.0059859753     1     1.679872e-02     6.089963e-02
    1552376034.1641490459     2     6.970948e-03     2.493615e-02
    1552376371.0962839127     3     5.678646e-03     2.274644e-03
    1552376697.5644319057     4     5.529870e-03     9.008393e-04
    1552377083.091490984     5     5.521264e-03     4.901418e-05
    1552377408.1923480034     6     5.521236e-03     5.834937e-07
    1552377528.5776081085     7     5.521236e-03     3.820827e-10
]
mypush!(df, method_name, time_iter_q_normgradq)

method_name = "buf-HyperDual"
time_iter_q_normgradq = [
    1.552377537286003e9     -1     9.973847e-02     9.846679e-02
    1552377808.9966950417     0     9.973847e-02     9.846679e-02
    1552378090.9059560299     1     1.679872e-02     6.089963e-02
    1552378402.382502079     2     6.970948e-03     2.493615e-02
    1552378639.1824359894     3     5.678646e-03     2.274644e-03
    1552378866.5456929207     4     5.529870e-03     9.008393e-04
    1552379104.7625238895     5     5.521264e-03     4.901418e-05
    1552379328.408288002     6     5.521236e-03     5.834913e-07
    1552379419.0961139202     7     5.521236e-03     3.700884e-10
]
mypush!(df, method_name, time_iter_q_normgradq)

list_methods = ["FLASH", "Dual", "buf-HyperDual", "sym-HyperDual", "HyperDual", "FiniteDiff", "Complex"]

Array_colors_RGB = [
     0   0   0
     0 114 178
    66 160 213
    86 180 233
   106 200 253
     0 158 115
   230 159   0
]

using Colors
# function to transform RGB (from 0 to 255) color array into list of hex
function Array_color_RGB_to_hex_list(M)
    out = Array{String,1}(undef, 0)
    for icol in 1:size(M, 1)
        r, g, b = M[icol, :] / 255
        push!(out, "#" * hex(RGB(r, g, b)))
    end 
    return out
end

mycolors = Array_color_RGB_to_hex_list(Array_colors_RGB)

p = df |>
@vlplot(
    width=300,
    mark={
        :line,
        interpolate="step-before"
    },
    encoding={
        x={:time, title="Elapsed computation time (seconds)"},
        y={:normgradq, title="norm of gradient", scale={typ=:log}},
        shape={:method, typ="nominal", scale={domain=list_methods}},
        color={:method, typ="nominal", scale={range=mycolors, domain=list_methods}}
    },
    resolve={
        scale={
            color="independent",
            shape="independent"
        },
    }
)

path_to_package_root = joinpath(splitpath(@__DIR__)[1:end-1]...)
pdf_file = joinpath(path_to_package_root, "fig", "Optim_callback_katana_vegalite.pdf")
save(pdf_file, p)

#=

┌────────────────────────
│ Optimizing using method FLASH, and printing time and q :
│
│    1.552285149618742e9
│    time                   iteration      q(λ)           |Dq(λ)|
│    1552285262.5103099346     0     9.973847e-02     9.846679e-02
│    1552285371.4692571163     1     1.679872e-02     6.089963e-02
│    1552285511.096765995     2     6.970948e-03     2.493615e-02
│    1552285575.2337169647     3     5.678646e-03     2.274644e-03
│    1552285627.0646879673     4     5.529870e-03     9.008393e-04
│    1552285683.9633190632     5     5.521264e-03     4.901419e-05
│    1552285726.5941050053     6     5.521236e-03     5.834928e-07
│    1552285755.4307689667     7     5.521236e-03     3.744009e-10
└────────────────────────

┌────────────────────────
│ Optimizing using method FiniteDiff, and printing time and q :
│
│    1.552285769695254e9
│    time                   iteration      q(λ)           |Dq(λ)|
│    1552286163.6655740738     0     9.973847e-02     9.846679e-02
│    1552286547.5203258991     1     1.679853e-02     6.089921e-02
│    1552286976.8766720295     2     6.970752e-03     2.493435e-02
│    1552287323.8391370773     3     5.678668e-03     2.275158e-03
│    1552287654.4600300789     4     5.529873e-03     9.009779e-04
│    1552287999.3380770683     5     5.521264e-03     4.902208e-05
│    1552288326.3779881001     6     5.521236e-03     5.855503e-07
│    1552288357.3542480469     7     5.521236e-03     3.754357e-10
└────────────────────────

┌────────────────────────
│ Optimizing using method Dual, and printing time and q :
│
│    1.552288367126222e9
│    time                   iteration      q(λ)           |Dq(λ)|
│    1552288687.195045948     0     9.973847e-02     9.846679e-02
│    1552288954.4081599712     1     1.679872e-02     6.089963e-02
│    1552289317.5387248993     2     6.970948e-03     2.493615e-02
│    1552289539.5822749138     3     5.678646e-03     2.274644e-03
│    1552289757.4462211132     4     5.529870e-03     9.008393e-04
│    1552290089.9508259296     5     5.521264e-03     4.901418e-05
│    1552290305.0491220951     6     5.521236e-03     5.834965e-07
│    1552290333.1003849506     7     5.521236e-03     3.862567e-10
└────────────────────────

┌────────────────────────
│ Optimizing using method Complex, and printing time and q :
│
│    1.552290341901904e9
│    time                   iteration      q(λ)           |Dq(λ)|
│    1552290847.9102509022     0     9.973847e-02     9.846679e-02
│    1552291250.8377010822     1     1.679872e-02     6.089963e-02
│    1552291806.8812630177     2     6.970948e-03     2.493615e-02
│    1552292157.0304598808     3     5.678646e-03     2.274644e-03
│    1552292503.4707729816     4     5.529870e-03     9.008393e-04
│    1552292975.3528540134     5     5.521264e-03     4.901420e-05
│    1552293329.6839270592     6     5.521236e-03     5.834909e-07
│    1552293357.8559169769     7     5.521236e-03     3.617950e-10
└────────────────────────

┌────────────────────────
│ Optimizing using method HyperDual, and printing time and q :
│
│    1.552293366675875e9
│    time                   iteration      q(λ)           |Dq(λ)|
│    1552294654.9384651184     0     9.973847e-02     9.846679e-02
│    1552295606.6262910366     1     1.679872e-02     6.089963e-02
│    1552296939.1215419769     2     6.970948e-03     2.493615e-02
│    1552297865.3929319382     3     5.678646e-03     2.274644e-03
│    1552298757.0831110477     4     5.529870e-03     9.008393e-04
│    1552300001.1723589897     5     5.521264e-03     4.901419e-05
│    1552300914.7481648922     6     5.521236e-03     5.834912e-07
│    1552301041.0953009129     7     5.521236e-03     3.724027e-10
└────────────────────────

┌────────────────────────
│ Optimizing using method sHyperDual, and printing time and q :
│
│    1.552301050019803e9
│    time                   iteration      q(λ)           |Dq(λ)|
│    1552301918.547385931     0     9.973847e-02     9.846679e-02
│    1552302578.5258059502     1     1.679872e-02     6.089963e-02
│    1552303495.229377985     2     6.970948e-03     2.493615e-02
│    1552304112.7929279804     3     5.678646e-03     2.274644e-03
│    1552304697.6630148888     4     5.529870e-03     9.008393e-04
│    1552305537.2959148884     5     5.521264e-03     4.901419e-05
│    1552306143.3304190636     6     5.521236e-03     5.834912e-07
│    1552306276.5732889175     7     5.521236e-03     3.724027e-10
└────────────────────────

┌────────────────────────
│ Optimizing using method bHyperDual, and printing time and q :
│
│    1.552306286265865e9
│    time                   iteration      q(λ)           |Dq(λ)|
│    1552306997.5528509617     0     9.973847e-02     9.846679e-02
│    1552307552.6609730721     1     1.679872e-02     6.089963e-02
│    1552308528.7847630978     2     6.970948e-03     2.493615e-02
│    1552309026.8967139721     3     5.678646e-03     2.274644e-03
│    1552309499.8328630924     4     5.529870e-03     9.008393e-04
│    1552310336.5372889042     5     5.521264e-03     4.901418e-05
│    1552310812.5246040821     6     5.521236e-03     5.834950e-07
│    1552310988.0982470512     7     5.521236e-03     3.830555e-10
└────────────────────────

=#
