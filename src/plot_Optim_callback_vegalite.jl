using VegaLite, DataFrames #
using LaTeXStrings




df = DataFrame(
    method = Array{String}(undef, 0),
    time = Array{Float64}(undef, 0),
    iteration = Array{Int64}(undef, 0),
    qval = Array{Float64}(undef, 0),
    normgradq = Array{Float64}(undef, 0)
)
function mypush!(df, method_name, time_iter_q_normgradq)
    start_time = time_iter_q_normgradq[1, 1]
    for i in 2:size(time_iter_q_normgradq, 1)
        time_iter_q_normgradq[i, 1] -= start_time
        time_iter_q_normgradq[:, 1] .= max.(time_iter_q_normgradq[:, 1], 100.0)
        push!(df, [method_name; time_iter_q_normgradq[i, :]])
    end
    return df
end


println("The data being plotted was copy-pasted from Katana output!")
#    time                   iteration      q(λ)           |Dq(λ)|
method_name = "F-zero"
time_iter_q_normgradq = [
    1.553058466623736e9      -1           NaN                 NaN
    1553058558.3915519714     0     9.973847e-02     9.846679e-02
    1553058660.2097361088     1     1.679872e-02     6.089963e-02
    1553058790.1636390686     2     6.970948e-03     2.493615e-02
    1553058847.5272729397     3     5.678646e-03     2.274644e-03
    1553058894.8405189514     4     5.529870e-03     9.008393e-04
    1553058950.5175509453     5     5.521264e-03     4.901419e-05
    1553058991.9311230183     6     5.521236e-03     5.834945e-07
    1553059019.9644811153     7     5.521236e-03     3.852644e-10
]
mypush!(df, method_name, time_iter_q_normgradq)

method_name = "DUAL"
time_iter_q_normgradq = [
    1.553056693517358e9      -1           NaN                 NaN
    1553056986.7934200764     0     9.973847e-02     9.846679e-02
    1553057236.9062509537     1     1.679872e-02     6.089963e-02
    1553057571.2353858948     2     6.970948e-03     2.493615e-02
    1553057781.088176012     3     5.678646e-03     2.274644e-03
    1553057977.9150750637     4     5.529870e-03     9.008393e-04
    1553058234.6615550518     5     5.521264e-03     4.901419e-05
    1553058429.8068630695     6     5.521236e-03     5.834920e-07
    1553058458.0107290745     7     5.521236e-03     3.873180e-10
]
mypush!(df, method_name, time_iter_q_normgradq)

method_name = "FD1"
time_iter_q_normgradq = [
    1.553051368695274e9      -1           NaN                 NaN
    1553051738.6130700111     0     9.973847e-02     9.846679e-02
    1553052106.3674330711     1     1.679853e-02     6.089921e-02
    1553052518.3192501068     2     6.970752e-03     2.493435e-02
    1553052847.994508028     3     5.678668e-03     2.275158e-03
    1553053163.0687360764     4     5.529873e-03     9.009779e-04
    1553053490.5870330334     5     5.521264e-03     4.902208e-05
    1553053807.8868370056     6     5.521236e-03     5.855503e-07
    1553053836.2834730148     7     5.521236e-03     3.754357e-10
]
mypush!(df, method_name, time_iter_q_normgradq)

method_name = "CSD"
time_iter_q_normgradq = [
    1.553053845007165e9      -1           NaN                 NaN
    1553054314.2244710922     0     9.973847e-02     9.846679e-02
    1553054698.8757269382     1     1.679872e-02     6.089963e-02
    1553055219.491063118     2     6.970948e-03     2.493615e-02
    1553055553.7925488949     3     5.678646e-03     2.274644e-03
    1553055882.6386799812     4     5.529870e-03     9.008393e-04
    1553056323.2897028923     5     5.521264e-03     4.901418e-05
    1553056656.5593919754     6     5.521236e-03     5.834949e-07
    1553056684.8178679943     7     5.521236e-03     3.976156e-10
]
mypush!(df, method_name, time_iter_q_normgradq)


method_name = "F1"
time_iter_q_normgradq = [
    1.553067198771712e9      -1           NaN                 NaN
    1553067379.5433189869     0     9.973847e-02     9.846679e-02
    1553067571.5013079643     1     1.679872e-02     6.089963e-02
    1553067793.0207700729     2     6.970948e-03     2.493615e-02
    1553067939.6985139847     3     5.678646e-03     2.274644e-03
    1553068076.4873969555     4     5.529870e-03     9.008393e-04
    1553068222.8983719349     5     5.521264e-03     4.901420e-05
    1553068356.3316318989     6     5.521236e-03     5.834948e-07
    1553068417.231153965     7     5.521236e-03     3.844704e-10
]
mypush!(df, method_name, time_iter_q_normgradq)

method_name = "HYPER"
time_iter_q_normgradq = [
    1.553059028556529e9      -1           NaN                 NaN
    1553060363.1943840981     0     9.973847e-02     9.846679e-02
    1553061380.3292610645     1     1.679872e-02     6.089963e-02
    1553062791.7036290169     2     6.970948e-03     2.493615e-02
    1553063792.6605830193     3     5.678646e-03     2.274644e-03
    1553064771.2272570133     4     5.529870e-03     9.008393e-04
    1553066072.2067210674     5     5.521264e-03     4.901419e-05
    1553067066.5661590099     6     5.521236e-03     5.834979e-07
    1553067189.9448719025     7     5.521236e-03     3.859966e-10
]
mypush!(df, method_name, time_iter_q_normgradq)


method_name = "FD2"
time_iter_q_normgradq = [
    1.553068426058954e9      -1           NaN                 NaN
    1553070839.6219370365     0     9.973847e-02     9.846782e-02
    1553073133.9709260464     1     3.108380e-02     7.219605e-02
    1553073366.5608611107     2     3.108380e-02     7.219605e-02
    1553075623.0852799416     3     1.590823e-02     9.821364e-03
    1553077877.59384799     4     1.320026e-02     9.789139e-03
    1553080169.1325290203     5     9.045239e-03     8.962242e-03
    1553082451.8377709389     6     6.306687e-03     4.704516e-03
    1553082734.7908248901     7     6.306687e-03     4.704516e-03
    1553085090.4241130352     8     5.852420e-03     1.519309e-03
    1553087338.6483490467     9     5.668477e-03     7.470323e-04
    1553089574.7989850044    10     5.538467e-03     1.461994e-04
    1553091836.4531359673    11     5.528558e-03     1.163430e-04
    1553092081.3732819557    12     5.528558e-03     1.163430e-04
    1553092333.7523639202    13     5.528558e-03     1.163430e-04
    1553094555.3073570728    14     5.523903e-03     3.631611e-05
    1553096880.7214670181    15     5.521337e-03     2.741271e-05
    1553099280.0317430496    16     5.521263e-03     1.552756e-05
    1553101651.4675049782    17     5.521239e-03     1.287859e-06
    1553104004.6843600273    18     5.521237e-03     1.162663e-06
    1553106360.2038669586    19     5.521236e-03     3.473530e-07
    1553108712.2645759583    20     5.521236e-03     6.834419e-08
    1553111060.0819420815    21     5.521236e-03     4.660756e-08
    1553111290.281719923    22     5.521236e-03     9.086132e-09
]
mypush!(df, method_name, time_iter_q_normgradq)

list_methods = ["F-zero", "DUAL", "FD1", "CSD", "F1", "HYPER", "FD2"]
# mycolors = [
#     "#000000"
#     "#40004b"
#     "#9970ab"
#     "#762a83"
#     "#00441b"
#     "#1b7837"
#     "#5aae61"
# ]

# Julia_colors_RGB 
# darker_blue    = [0.251, 0.388, 0.847]
# lighter_blue   = [0.4  , 0.51 , 0.878]
darker_purple  = [0.584, 0.345, 0.698]
# lighter_purple = [0.667, 0.475, 0.757]
darker_green   = [0.22 , 0.596, 0.149]
# lighter_green  = [0.376, 0.678, 0.318]
# darker_red     = [0.796, 0.235, 0.2  ]
# lighter_red    = [0.835, 0.388, 0.361]
#


mycolors_RGB = 0.85ones(7,3) # gray base
mycolors_RGB[1, :] .= darker_purple
mycolors_RGB[2:4, :] .= 0.65
mycolors_RGB[5, :] .= darker_green

mymarkers = ["cross", "diamond", "square", "circle", "cross", "diamond", "square"]

using Colors
# function to transform RGB (from 0 to 1) color array into list of hex
function array_of_RGB_to_hex_list(M)
    out = Array{String,1}(undef, 0)
    for icol in 1:size(M, 1)
        r, g, b = M[icol, :]
        push!(out, "#" * hex(RGB(r, g, b)))
    end
    return out
end
#
mycolors = array_of_RGB_to_hex_list(mycolors_RGB)
p = df |>
@vlplot(
    width=500,
    height=400,
    mark={
        :line,
        interpolate="step-before",
    },
    encoding={
        x={:time, title="Elapsed computation time (seconds)", scale={typ=:log,domain=[100,30000]}},
        y={:normgradq, title="|∇f|", scale={typ=:log, domain=[1e-11,1e-1]}},
        shape={:method, typ="nominal", scale={range=mymarkers, domain=list_methods}, legend={orient="top-right"}},
        color={:method, typ="nominal", scale={range=mycolors, domain=list_methods}}
    },
    resolve={
        scale={
            color="independent",
            shape="independent"
        },
    }
)

path_to_package_root = joinpath(splitpath(@__DIR__)[1:end-1]...)
pdf_file = joinpath(path_to_package_root, "fig", "Optim_callback_katana_vegalite.pdf")
save(pdf_file, p)


svg_file = joinpath(path_to_package_root, "fig", "Optim_callback_katana_vegalite.svg")
save(svg_file, p)
#=

────────────────────────
 Optimizing using method FD1, for Precompiled run

    1.553051368695274e9      -1           NaN                 NaN
    1553051738.6130700111     0     9.973847e-02     9.846679e-02
    1553052106.3674330711     1     1.679853e-02     6.089921e-02
    1553052518.3192501068     2     6.970752e-03     2.493435e-02
    1553052847.994508028     3     5.678668e-03     2.275158e-03
    1553053163.0687360764     4     5.529873e-03     9.009779e-04
    1553053490.5870330334     5     5.521264e-03     4.902208e-05
    1553053807.8868370056     6     5.521236e-03     5.855503e-07
    1553053836.2834730148     7     5.521236e-03     3.754357e-10
────────────────────────

────────────────────────
 Optimizing using method CSD, for Precompiled run

    1.553053845007165e9      -1           NaN                 NaN
    1553054314.2244710922     0     9.973847e-02     9.846679e-02
    1553054698.8757269382     1     1.679872e-02     6.089963e-02
    1553055219.491063118     2     6.970948e-03     2.493615e-02
    1553055553.7925488949     3     5.678646e-03     2.274644e-03
    1553055882.6386799812     4     5.529870e-03     9.008393e-04
    1553056323.2897028923     5     5.521264e-03     4.901418e-05
    1553056656.5593919754     6     5.521236e-03     5.834949e-07
    1553056684.8178679943     7     5.521236e-03     3.976156e-10
────────────────────────

────────────────────────
 Optimizing using method DUAL, for Precompiled run

    1.553056693517358e9      -1           NaN                 NaN
    1553056986.7934200764     0     9.973847e-02     9.846679e-02
    1553057236.9062509537     1     1.679872e-02     6.089963e-02
    1553057571.2353858948     2     6.970948e-03     2.493615e-02
    1553057781.088176012     3     5.678646e-03     2.274644e-03
    1553057977.9150750637     4     5.529870e-03     9.008393e-04
    1553058234.6615550518     5     5.521264e-03     4.901419e-05
    1553058429.8068630695     6     5.521236e-03     5.834920e-07
    1553058458.0107290745     7     5.521236e-03     3.873180e-10
────────────────────────

────────────────────────
 Optimizing using method FLASH, for Precompiled run

    1.553058466623736e9      -1           NaN                 NaN
    1553058558.3915519714     0     9.973847e-02     9.846679e-02
    1553058660.2097361088     1     1.679872e-02     6.089963e-02
    1553058790.1636390686     2     6.970948e-03     2.493615e-02
    1553058847.5272729397     3     5.678646e-03     2.274644e-03
    1553058894.8405189514     4     5.529870e-03     9.008393e-04
    1553058950.5175509453     5     5.521264e-03     4.901419e-05
    1553058991.9311230183     6     5.521236e-03     5.834945e-07
    1553059019.9644811153     7     5.521236e-03     3.852644e-10
────────────────────────

────────────────────────
 Optimizing using method HYPER, for Precompiled run

    1.553059028556529e9      -1           NaN                 NaN
    1553060363.1943840981     0     9.973847e-02     9.846679e-02
    1553061380.3292610645     1     1.679872e-02     6.089963e-02
    1553062791.7036290169     2     6.970948e-03     2.493615e-02
    1553063792.6605830193     3     5.678646e-03     2.274644e-03
    1553064771.2272570133     4     5.529870e-03     9.008393e-04
    1553066072.2067210674     5     5.521264e-03     4.901419e-05
    1553067066.5661590099     6     5.521236e-03     5.834979e-07
    1553067189.9448719025     7     5.521236e-03     3.859966e-10
────────────────────────

────────────────────────
 Optimizing using method HYPERSMART, for Precompiled run

    1.553067198771712e9      -1           NaN                 NaN
    1553067379.5433189869     0     9.973847e-02     9.846679e-02
    1553067571.5013079643     1     1.679872e-02     6.089963e-02
    1553067793.0207700729     2     6.970948e-03     2.493615e-02
    1553067939.6985139847     3     5.678646e-03     2.274644e-03
    1553068076.4873969555     4     5.529870e-03     9.008393e-04
    1553068222.8983719349     5     5.521264e-03     4.901420e-05
    1553068356.3316318989     6     5.521236e-03     5.834948e-07
    1553068417.231153965     7     5.521236e-03     3.844704e-10
────────────────────────

────────────────────────
 Optimizing using method FD2, for Precompiled run

    1.553068426058954e9      -1           NaN                 NaN
    1553070839.6219370365     0     9.973847e-02     9.846782e-02
    1553073133.9709260464     1     3.108380e-02     7.219605e-02
    1553073366.5608611107     2     3.108380e-02     7.219605e-02
    1553075623.0852799416     3     1.590823e-02     9.821364e-03
    1553077877.59384799     4     1.320026e-02     9.789139e-03
    1553080169.1325290203     5     9.045239e-03     8.962242e-03
    1553082451.8377709389     6     6.306687e-03     4.704516e-03
    1553082734.7908248901     7     6.306687e-03     4.704516e-03
    1553085090.4241130352     8     5.852420e-03     1.519309e-03
    1553087338.6483490467     9     5.668477e-03     7.470323e-04
    1553089574.7989850044    10     5.538467e-03     1.461994e-04
    1553091836.4531359673    11     5.528558e-03     1.163430e-04
    1553092081.3732819557    12     5.528558e-03     1.163430e-04
    1553092333.7523639202    13     5.528558e-03     1.163430e-04
    1553094555.3073570728    14     5.523903e-03     3.631611e-05
    1553096880.7214670181    15     5.521337e-03     2.741271e-05
    1553099280.0317430496    16     5.521263e-03     1.552756e-05
    1553101651.4675049782    17     5.521239e-03     1.287859e-06
    1553104004.6843600273    18     5.521237e-03     1.162663e-06
    1553106360.2038669586    19     5.521236e-03     3.473530e-07
    1553108712.2645759583    20     5.521236e-03     6.834419e-08
    1553111060.0819420815    21     5.521236e-03     4.660756e-08
    1553111290.281719923    22     5.521236e-03     9.086132e-09
────────────────────────




=#
